<!doctype html><html lang>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Setting up a NFS server is quite straight forward, there&amp;rsquo;re user guides from linux distributors and blogs. However, there are always some cornor cases which requires additional steps or configurations to make it work properly.
This post is focusing on the trouble shooting part with a reference to guides for the NFS server setup.
Set up the NFS server I would like to recomend the redhat user guide on setting up the NFS server, which has in depth and in detail explainations on the services and components, along with the step-by-step instructions."><title>Setting Up NFS Server</title>
<link rel=canonical href=/posts/setting_up_nfs_server/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Setting Up NFS Server">
<meta property="og:description" content="Setting up a NFS server is quite straight forward, there&amp;rsquo;re user guides from linux distributors and blogs. However, there are always some cornor cases which requires additional steps or configurations to make it work properly.
This post is focusing on the trouble shooting part with a reference to guides for the NFS server setup.
Set up the NFS server I would like to recomend the redhat user guide on setting up the NFS server, which has in depth and in detail explainations on the services and components, along with the step-by-step instructions.">
<meta property="og:url" content="/posts/setting_up_nfs_server/">
<meta property="og:site_name" content="Brayden's Blog">
<meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="nfs"><meta property="article:tag" content="nfs server"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="centos"><meta property="article:published_time" content="2022-01-23T00:00:00+00:00"><meta property="article:modified_time" content="2022-01-23T00:00:00+00:00"><meta property="og:image" content="/images/kissclipart-nfs.png">
<meta name=twitter:title content="Setting Up NFS Server">
<meta name=twitter:description content="Setting up a NFS server is quite straight forward, there&amp;rsquo;re user guides from linux distributors and blogs. However, there are always some cornor cases which requires additional steps or configurations to make it work properly.
This post is focusing on the trouble shooting part with a reference to guides for the NFS server setup.
Set up the NFS server I would like to recomend the redhat user guide on setting up the NFS server, which has in depth and in detail explainations on the services and components, along with the step-by-step instructions."><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/images/kissclipart-nfs.png">
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/posts/setting_up_nfs_server/>
<img src=/images/kissclipart-nfs.png loading=lazy alt="Featured image of post Setting Up NFS Server">
</a>
</div>
<div class=article-details>
<section class=article-tags>
<a href=/tags/nfs/>nfs</a>
<a href=/tags/nfs-server/>nfs server</a>
<a href=/tags/ubuntu/>ubuntu</a>
<a href=/tags/centos/>centos</a>
</section>
<h2 class=article-title>
<a href=/posts/setting_up_nfs_server/>Setting Up NFS Server</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 23, 2022</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
3 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<p>Setting up a NFS server is quite straight forward, there&rsquo;re user guides from linux distributors and blogs. However, there are always some cornor cases which requires additional steps or configurations to make it work properly.</p>
<p>This post is focusing on the trouble shooting part with a reference to guides for the NFS server setup.</p>
<h2 id=set-up-the-nfs-server>Set up the NFS server</h2>
<p>I would like to recomend the redhat user guide on setting up the NFS server, which has in depth and in detail explainations on the services and components, along with the step-by-step instructions.
<a class=link href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_file_systems/exporting-nfs-shares_managing-file-systems target=_blank rel=noopener>RHEL8 NFS server setup</a></p>
<p>Do enable the services and ports as described in the user guide if you are running the firewall.</p>
<pre><code>firewall-cmd --permanent --add-service mountd
firewall-cmd --permanent --add-service rpc-bind
firewall-cmd --permanent --add-service nfs
firewall-cmd --permanent --add-port=2049/tcp
firewall-cmd --reload
</code></pre>
<h3 id=failed-to-start-up-the-nfs-server>Failed to start up the NFS server</h3>
<pre><code>$ systemctl status rpcbind
\u25cf rpcbind.service - RPC bind service
   Loaded: loaded (/usr/lib/systemd/system/rpcbind.service; indirect; vendor preset: enabled)
   Active: failed (Result: exit-code) since Tue 2017-12-26 13:30:11 CST; 14s ago
  Process: 20650 ExecStart=/sbin/rpcbind -w $RPCBIND_ARGS (code=exited, status=0/SUCCESS)
 Main PID: 20653 (code=exited, status=1/FAILURE)

Dec 26 13:30:11 8d58 systemd[1]: Starting RPC bind service...
Dec 26 13:30:11 8d58 systemd[1]: Started RPC bind service.
Dec 26 13:30:11 8d58 rpcbind[20650]: rpcbind: fork failed: No such device
Dec 26 13:30:11 8d58 systemd[1]: rpcbind.service: main process exited, code=exited, status=1/FAILURE
Dec 26 13:30:11 8d58 systemd[1]: Unit rpcbind.service entered failed state.
Dec 26 13:30:11 8d58 systemd[1]: rpcbind.service failed.
</code></pre>
<p>The root cause might be /dev/null is not correctly labeled if selinux is on, or turn on/off in between. Normally reboot the system will resolve the issue - the system will relabel the file system at startup upon switching on/off selinux. Or <code>fixfile relabel</code> and <code>reboot</code>.</p>
<h3 id=selinux-is-preventing-usrbinrpcidmapd-from-write-access-on-the-file-null>selinux is preventing /usr/bin/rpc.idmapd from write access on the file null</h3>
<pre><code>*****  Plugin catchall (100. confidence) suggests   **************************
                                
If you believe that rpc.idmapd should be allowed write access on the null file by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do allow this access for now by executing:
$ ausearch -c 'rpc.idmapd' --raw | audit2allow -M my-rpcidmapd
$ semodule -i my-rpcidmapd.pp
</code></pre>
<h2 id=mount-the-nfs-share-on-client>Mount the NFS share on client</h2>
<h3 id=mountnfs-no-such-device>mount.nfs no such device</h3>
<p>For some clients, the mount might fail as:</p>
<pre><code>mount 192.168.8.3:/store /mnt/nfs
mount.nfs: No such device
</code></pre>
<p>Usually, it&rsquo;s because the nfs/nfsv4 module is not loaded, trying to load the module</p>
<pre><code>$ modprobe nfs
modprobe: ERROR: could not insert 'nfs': Invalid argument
</code></pre>
<p>from dmesg:</p>
<pre><code>[2192390.701420] FS-Cache: Loaded
[2192390.709699] lockd: `' invalid for parameter `nlm_tcpport'
</code></pre>
<p>This is caused by improper configurations of lockd.
Update the <code>/etc/modprobe.d/lockd.conf</code> to add &ldquo;=&rdquo; between <code>nlm_xxxport</code> and <code>&lt;port></code>.</p>
<pre><code>options lockd nlm_tcpport=60001
options lockd nlm_udpport=60002
</code></pre>
<p>try <code>mount 192.168.8.3:/store /mnt/nfs</code> again, should be completed successfully.</p>
</section>
<footer class=article-footer>
<header class=article-category>
<a href=/categories/memos/>
memos
</a>
<a href=/categories/tips/>
tips
</a>
</header>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=/posts/recover_ubuntu_from_initramfs_error/>
<div class=article-image>
<img src=/images/initramfs.png loading=lazy data-key data-hash=/images/initramfs.png>
</div>
<div class=article-details>
<h2 class=article-title>Recover Ubuntu from initramfs error caused by improper shutdown</h2>
</div>
</a>
</article>
<article class=has-image>
<a href=/posts/dual_home_ubuntu/>
<div class=article-image>
<img src=/images/Networking.jpg loading=lazy data-key data-hash=/images/Networking.jpg>
</div>
<div class=article-details>
<h2 class=article-title>Route setting in Multihomed Server</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//brayblog.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 -
2022 Brayden's Blog
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ul>
<li><a href=#set-up-the-nfs-server>Set up the NFS server</a>
<ul>
<li><a href=#failed-to-start-up-the-nfs-server>Failed to start up the NFS server</a></li>
<li><a href=#selinux-is-preventing-usrbinrpcidmapd-from-write-access-on-the-file-null>selinux is preventing /usr/bin/rpc.idmapd from write access on the file null</a></li>
</ul>
</li>
<li><a href=#mount-the-nfs-share-on-client>Mount the NFS share on client</a>
<ul>
<li><a href=#mountnfs-no-such-device>mount.nfs no such device</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>