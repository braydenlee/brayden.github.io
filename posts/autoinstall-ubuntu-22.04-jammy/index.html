<!doctype html><html lang>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Issue description Automation of OS installation and configuration not only saves tremendous efforts and unifies the installation and configuration which otherwise might be different as various decisions made by the user during the process, but also help you out where you could not perform a normal manual installation. I once installed a board with no video support (only serial console available) while the installer requires GUI for the interactive sections."><title>Create an autoinstall iso for ubuntu 22.04</title><link rel=canonical href=/posts/autoinstall-ubuntu-22.04-jammy/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Create an autoinstall iso for ubuntu 22.04">
<meta property="og:description" content="Issue description Automation of OS installation and configuration not only saves tremendous efforts and unifies the installation and configuration which otherwise might be different as various decisions made by the user during the process, but also help you out where you could not perform a normal manual installation. I once installed a board with no video support (only serial console available) while the installer requires GUI for the interactive sections.">
<meta property="og:url" content="/posts/autoinstall-ubuntu-22.04-jammy/">
<meta property="og:site_name" content="Brayden's Blog">
<meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="ISO"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="autoinstall"><meta property="article:tag" content="kickstart"><meta property="article:published_time" content="2022-03-07T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-07T00:00:00+00:00"><meta property="og:image" content="/images/automation.jpg">
<meta name=twitter:title content="Create an autoinstall iso for ubuntu 22.04">
<meta name=twitter:description content="Issue description Automation of OS installation and configuration not only saves tremendous efforts and unifies the installation and configuration which otherwise might be different as various decisions made by the user during the process, but also help you out where you could not perform a normal manual installation. I once installed a board with no video support (only serial console available) while the installer requires GUI for the interactive sections."><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/images/automation.jpg">
</head><body class="article-page has-toc">
<script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div><main class="main full-width">
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/posts/autoinstall-ubuntu-22.04-jammy/>
<img src=/images/automation.jpg loading=lazy alt="Featured image of post Create an autoinstall iso for ubuntu 22.04">
</a>
</div><div class=article-details>
<section class=article-tags>
<a href=/tags/iso/>ISO</a>
<a href=/tags/ubuntu/>ubuntu</a>
<a href=/tags/autoinstall/>autoinstall</a>
<a href=/tags/kickstart/>kickstart</a>
</section><h2 class=article-title>
<a href=/posts/autoinstall-ubuntu-22.04-jammy/>Create an autoinstall iso for ubuntu 22.04</a>
</h2><footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 07, 2022</time>
</div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
3 minute read
</time>
</div></footer></div></header><section class=article-content>
<h2 id=issue-description>Issue description</h2><p>Automation of OS installation and configuration not only saves tremendous efforts and unifies the installation and configuration which otherwise might be different as various decisions made by the user during the process, but also help you out where you could not perform a normal manual installation. I once installed a board with no video support (only serial console available) while the installer requires GUI for the interactive sections.<br>
Auto install is nothing new, while we single out ubuntu 22.04, because it obsoleted the legacy preseed approach, replaced with its new installer subiquity.<br>
There are documents from the community on the new autoinstall. However, for newbees, the doc is simply insufficient. And once you get the autoinstall up and running, you will find all info required already included in the doc.<br>
I realized that, what the newbees need, is a complete, working example.
In this guide, we will customize the ubuntu server live ISO, modify the grub menu to add autoinstall parameters, and add autoinstall configuration files to the ISO.
For repack the ISO, please refer to my previous post <a class=link href=https://braydenlee.gitee.io/posts/re-pack-ubuntu-22.04-live-server-iso/ target=_blank rel=noopener>Re-pack Ubuntu 22.04 live ISO</a>.</p><h2 id=the-detailed-steps>The detailed steps</h2><p>It&rsquo;s quite straightforward to customize the ISO with autoinstall:</p><ul>
<li>Update the GRUB menu</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vim boot/grub/grub.cfg
</span></span><span style=display:flex><span><span style=color:#75715e># add auto=true autoinstall priority=critical locale=en_US ds=&#39;nocloud;s=/cdrom/nocloud/&#39; fsck.mode=skip</span>
</span></span><span style=display:flex><span><span style=color:#75715e># _autoinstall_ is required if you want to suppress the prompt for confirming the installation. The purpose of asking confirmation is to avoid accidentally reformat a machine with the autoinstall enabled USB drive/ISO image. So if we definitely want to have a fully automated installation, we could add the _autoinstall_.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># _locale=en_US_ to suppress the language window -- as if the locale section comes prior to the autoinstall conf, so for a fully automated installation, we add it to the command line.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># _ds=..._ specify where the autoinstall conf files could be found. Note the ending &#39;/&#39; is a must.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># _fsck.mode=skip_ to skip the installation media check. In most of the cases, we haven&#39;t see problem with the installation media, so skip the check to accelerate the installation process.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># you could keep the original menuentry and create a new one below the original entry, so your ISO supports both manual and automated installation.</span>
</span></span><span style=display:flex><span>menuentry <span style=color:#e6db74>&#34;Ubuntu Server - *** will wipe your first disk ***&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        set gfxpayload<span style=color:#f92672>=</span>keep
</span></span><span style=display:flex><span>        linux   /casper/vmlinuz auto<span style=color:#f92672>=</span>true autoinstall priority<span style=color:#f92672>=</span>critical locale<span style=color:#f92672>=</span>en_US ds<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;nocloud;s=/cdrom/nocloud/&#39;</span> fsck.mode<span style=color:#f92672>=</span>skip quiet ---
</span></span><span style=display:flex><span>        initrd  /casper/initrd
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul>
<li>Add the autoinstall conf files</li></ul><p>In previous section, we specified /cdrom/nocloud as the source for the autoinstall conf. So we shall create a folder with the name <em>nocloud</em> within the root directory in the ISO.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mkdir nocloud
</span></span><span style=display:flex><span>$ cd nocloud
</span></span><span style=display:flex><span>$ touch meta-data
</span></span><span style=display:flex><span>$ vim user-data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#cloud-config</span>
</span></span><span style=display:flex><span>autoinstall:
</span></span><span style=display:flex><span>  version: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  locale: en_US
</span></span><span style=display:flex><span>  <span style=color:#75715e># passwd: *** you should replace this part with your own encrypted password***</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Example (root is the password): </span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># $ printf &#39;root&#39; | openssl passwd -6 -salt &#39;FhcddHFVZ7ABA4Gi&#39; -stdin</span>
</span></span><span style=display:flex><span>  identity: <span style=color:#f92672>{</span>hostname: ubuntu2204, username: admin, password: <span style=color:#e6db74>&#39;$6$2/pERGoDzVMr3JHf$2je/NWRdDEDQW5/tAEXt5hziH3eTmqj5cMirlPkWuvuXVp0o3KG9eh1aqxjk3DRM/fZr2DrwEaKKDoZ/V9HYU.&#39;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  ssh:
</span></span><span style=display:flex><span>    install-server: yes
</span></span><span style=display:flex><span>    allow-pw: yes
</span></span><span style=display:flex><span>  network:
</span></span><span style=display:flex><span>    version: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    ethernets:
</span></span><span style=display:flex><span>      eno1:
</span></span><span style=display:flex><span>        match:
</span></span><span style=display:flex><span>          name: <span style=color:#e6db74>&#34;eno*&#34;</span>
</span></span><span style=display:flex><span>        dhcp6: no
</span></span><span style=display:flex><span>        dhcp4: no
</span></span><span style=display:flex><span>      enp3s0f3:
</span></span><span style=display:flex><span>        critical: true
</span></span><span style=display:flex><span>        dhcp-identifier: mac
</span></span><span style=display:flex><span>        dhcp4: true
</span></span><span style=display:flex><span>  late-commands:
</span></span><span style=display:flex><span>    <span style=color:#75715e># in my setup, I have sometime special realtime packages and scripts</span>
</span></span><span style=display:flex><span>    - cp -r /media/cdrom/rt-kits /target/opt/
</span></span><span style=display:flex><span>    - curtin in-target --target<span style=color:#f92672>=</span>/target -- bash -c <span style=color:#e6db74>&#39;apt-get install -f -y /opt/rt-kits/linux-image-*.deb /opt/rt-kits/linux-modules-*.deb&#39;</span>
</span></span><span style=display:flex><span>    - curtin in-target --target<span style=color:#f92672>=</span>/target -- bash -c <span style=color:#e6db74>&#39;source /opt/rt-kits/update_kernel_cmdline.sh&#39;</span>
</span></span><span style=display:flex><span>    - 
</span></span></code></pre></div><p>That&rsquo;s all, now it&rsquo;s time to repack the ISO. Refer my previous post <a class=link href=https://braydenlee.gitee.io/posts/re-pack-ubuntu-22.04-live-server-iso/ target=_blank rel=noopener>Re-pack Ubuntu 22.04 live ISO</a></p><h2 id=references>References</h2><p><a class=link href=https://ubuntu.com/server/docs/install/autoinstall target=_blank rel=noopener>Ubuntu autoinstall</a><br>
<a class=link href=https://help.ubuntu.com/lts/installation-guide/amd64/apb.html target=_blank rel=noopener>The obsolete method - preseed</a></p></section><footer class=article-footer>
<header class=article-category>
<a href=/categories/memos/>
memos
</a>
<a href=/categories/tips/>
tips
</a>
</header></footer></article><aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2><div class=related-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=/posts/re-pack-ubuntu-22.04-live-server-iso/>
<div class=article-image>
<img src=/images/iso_disc.png loading=lazy data-key data-hash=/images/iso_disc.png>
</div><div class=article-details>
<h2 class=article-title>Re-pack Ubuntu 22.04 live server ISO</h2></div></a>
</article><article class=has-image>
<a href=/posts/setting_up_nfs_server/>
<div class=article-image>
<img src=/images/kissclipart-nfs.png loading=lazy data-key data-hash=/images/kissclipart-nfs.png>
</div><div class=article-details>
<h2 class=article-title>Setting Up NFS Server</h2></div></a>
</article><article class=has-image>
<a href=/posts/recover_ubuntu_from_initramfs_error/>
<div class=article-image>
<img src=/images/initramfs.png loading=lazy data-key data-hash=/images/initramfs.png>
</div><div class=article-details>
<h2 class=article-title>Recover Ubuntu from initramfs error caused by improper shutdown</h2></div></a>
</article><article class=has-image>
<a href=/posts/dual_home_ubuntu/>
<div class=article-image>
<img src=/images/Networking.jpg loading=lazy data-key data-hash=/images/Networking.jpg>
</div><div class=article-details>
<h2 class=article-title>Route setting in Multihomed Server</h2></div></a>
</article></div></div></aside><div class=disqus-container>
<div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//brayblog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 -
2022 Brayden's Blog
</section><section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div><div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main><aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc>
<nav id=TableOfContents>
<ul>
<li><a href=#issue-description>Issue description</a></li><li><a href=#the-detailed-steps>The detailed steps</a></li><li><a href=#references>References</a></li></ul></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script>
</body></html>