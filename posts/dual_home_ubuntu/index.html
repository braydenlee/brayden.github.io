<!doctype html><html lang>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="For dual homed servers which connects to Internet and internal networks, used to have routing issues. This guide provides a approach to correct the routing settings."><title>Route setting in Multihomed Server</title>
<link rel=canonical href=/posts/dual_home_ubuntu/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Route setting in Multihomed Server">
<meta property="og:description" content="For dual homed servers which connects to Internet and internal networks, used to have routing issues. This guide provides a approach to correct the routing settings.">
<meta property="og:url" content="/posts/dual_home_ubuntu/">
<meta property="og:site_name" content="Brayden's Blog">
<meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="network"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="netplan"><meta property="article:tag" content="routing"><meta property="article:published_time" content="2022-01-01T00:00:00+00:00"><meta property="article:modified_time" content="2022-01-01T00:00:00+00:00"><meta property="og:image" content="/images/Networking.jpg">
<meta name=twitter:title content="Route setting in Multihomed Server">
<meta name=twitter:description content="For dual homed servers which connects to Internet and internal networks, used to have routing issues. This guide provides a approach to correct the routing settings."><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/images/Networking.jpg">
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/posts/dual_home_ubuntu/>
<img src=/images/Networking.jpg loading=lazy alt="Featured image of post Route setting in Multihomed Server">
</a>
</div>
<div class=article-details>
<header class=article-category>
<a href=/categories/tips/>
tips
</a>
<a href=/categories/memos/>
memos
</a>
</header>
<h2 class=article-title>
<a href=/posts/dual_home_ubuntu/>Route setting in Multihomed Server</a>
</h2>
<h3 class=article-subtitle>
For dual homed servers which connects to Internet and internal networks, used to have routing issues. This guide provides a approach to correct the routing settings.
</h3>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 01, 2022</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
2 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h1 id=route-setting-in-multihomed-servers>Route setting in Multihomed servers</h1>
<h2 id=the-issue>The Issue</h2>
<p>For servers with multiples interfaces connecting to differenct networks, tend to have routing issues if multiple interfaces have default route settings.
For example, I have a server with two NICs, one connect to external network in subnet <code>10.67.126.x/23</code>, and the other connects to internal network in subnet <code>192.168.8.x/24</code>.
As the DHCP servers for the two subnets both provide default route, the routing table in my server will results in multiple default routes:</p>
<pre><code>default via 192.168.8.8 dev eno2 proto dhcp src 192.168.8.42 metric 100
default via 10.67.126.1 dev eno1 proto dhcp src 10.67.126.153 metric 100
10.67.126.0/23 dev eno1 proto kernel scope link src 10.67.126.153
10.67.126.1 dev eno1 proto dhcp scope link src 10.67.126.153 metric 100
192.168.8.0/24 dev eno2 proto kernel scope link src 192.168.8.42
192.168.8.8 dev eno2 proto dhcp scope link src 192.168.8.42 metric 100  
</code></pre>
<p>As a result, most of the services resides on the external network are un-reachable as the traffic would be directed to the wrong network.</p>
<h2 id=the-solution>The solution</h2>
<p>As my internal network is quite simply, all the other nodes are in the same subnet, and don&rsquo;t really need a gateway, so a simply fix is to disable the default route for the internal internface.
Following netplan conf is an example:</p>
<pre><code>$ cat /etc/netplan/00-installer-config.yaml
# This is the network config written by 'subiquity'
network:
  ethernets:
    ens260f0:
      critical: true
      dhcp-identifier: mac
      dhcp4: true
    ens260f1:
      critical: true
      dhcp-identifier: mac
      dhcp4: true
      dhcp4-overrides:
        use-routes: false
   version: 2
</code></pre>
<p>Then apply the settings</p>
<pre><code>$ sudo netplan apply  
</code></pre>
<p>Now check the routing table</p>
<pre><code>$ sudo ip route
default via 10.67.126.1 dev eno1 proto dhcp src 10.67.126.153 metric 100
10.67.126.0/23 dev eno1 proto kernel scope link src 10.67.126.153 metric 100
10.67.126.1 dev eno1 proto dhcp scope link src 10.67.126.153 metric 100
10.239.27.228 via 10.67.126.1 dev eno1 proto dhcp src 10.67.126.153 metric 100
10.248.2.5 via 10.67.126.1 dev eno1 proto dhcp src 10.67.126.153 metric 100
172.17.6.9 via 10.67.126.1 dev eno1 proto dhcp src 10.67.126.153 metric 100
</code></pre>
<h2 id=references>References</h2>
<p><a class=link href=https://askubuntu.com/questions/1042582/how-to-set-default-route-with-netplan-ubuntu-18-04-server-2-nic target=_blank rel=noopener>Set default route with netplan on Ubuntu</a></p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/network/>network</a>
<a href=/tags/ubuntu/>ubuntu</a>
<a href=/tags/netplan/>netplan</a>
<a href=/tags/routing/>routing</a>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//brayblog.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 -
2022 Brayden's Blog
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ul>
<li><a href=#the-issue>The Issue</a></li>
<li><a href=#the-solution>The solution</a></li>
<li><a href=#references>References</a></li>
</ul>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>